{% extends 'layouts/base_tool.html' %}
{% load bootstrap3 %}

{% block title %}
	Edit Simulation {{ model.name }}
{% endblock %}

{% block additionalcss %}


<style>
		
		#object-type-spec-box {
			border: solid 1px grey;
			height: 250px;
		}
		
		#search-box {
			box-shadow:inset 0 0 4px #eee; 
			width:120px; 
			margin:0; 
			padding:6px 12px; 
			border-radius:4px; 
			border:1px solid silver; 
			font-size:1.1em;
		}

		/* ---  Modal -------------------------------------------- */
		.modal-dialog {
			width:700px;
		}	
		
		.modal-header {		
			margin-right: 0px;
			margin-left: 0px;
			padding-right: 0px;
			padding-left: 0px;
		}
		
		#modal-title {
			font-size:22px;
		}
		
</style>
{% endblock %}

{% block content %}

	<br>
	<h1>3 - What objects are described by the table?</h1>
	<br>
		{% for error in errors %}
			<div class="error">{{ error }}</div><br>
		{% endfor %}

	
	
	
	
	<div class="form">
			<div>
				<input type="text" value="" id="search-box" placeholder="Search" />
			</div>
			<br>
		<div class="row">
			<div id="object-type-spec-box" class="col-sm-7">
				<div id="container-for-object-tree" ></div>
			</div>
			<div id="jstree-result" class="col-sm-5"></div> 
		</div>
		

	<div id="useful-things" style="visibility:hidden;">
		<div id="object_hierachy_tree">{{ object_hierachy_tree }}</div>
	</div>
	<br>	
	<button id="create-object-type" type="button" class="btn btn-primary" data-toggle="modal" data-target="#createObjectType">Create new Object Type</button>
	<br>
		<div class="row">
			<div class="col-md-4 col-sm-8 col-xs-8">
				<button type="button" class="btn btn-success btn-sm" onclick="demo_create();"><i class="glyphicon glyphicon-asterisk"></i> Create</button>
				<button type="button" class="btn btn-warning btn-sm" onclick="demo_rename();"><i class="glyphicon glyphicon-pencil"></i> Rename</button>
				<button type="button" class="btn btn-danger btn-sm" onclick="demo_delete();"><i class="glyphicon glyphicon-remove"></i> Delete</button>
			</div>
		</div>
	<br>

	<button type="submit" class="btn btn-primary">
		<span class="glyphicon glyphicon-star"></span> Next
	</button>
	
	
	
	<!-- Modal -->
	<div class="modal fade" id="createObjectType" tabindex="-1" role="dialog" aria-labelledby="chooseAttributeTitle" aria-hidden="true">
	  <div class="modal-dialog" role="document">
		<div class="modal-content">
		  <div class="modal-header row">
			<h5 class="modal-title col-md-11" id="modal-title">Create Object type.</h5>
			<button type="button col-md-1" class="close" data-dismiss="modal" aria-label="Close" style="margin-top:2px; margin-right:19px;font-size:29px">
			  <span aria-hidden="true" >&times;</span>
			</button>
		  </div>
		  <div class="modal-body">
			  <div class="container-fluid">
				<div class="row">
					<div class="col-md-7">
						left column <br>
						left column <br>
						left column <br>
						left column <br>
						left column <br>
						left column <br>
						left column <br>
					</div>
					<div class="col-md-7">
						right column <br>
						right column <br>
						right column <br>
						right column <br>
						right column <br>
						right column <br>
						right column <br>
					</div>
				</div>
			  </div>
		  </div>
		  <div class="modal-footer">
			<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
			<button type="button" class="btn btn-primary" onclick="saveAttributeSelection()" data-dismiss="modal">Save</button>
		  </div>
		</div>
	  </div>
	</div>
	
	

<script>
	
	function demo_create() {
		var ref = $('#container-for-object-tree').jstree(true),
			sel = ref.get_selected();
		if(!sel.length) { return false; }
		sel = sel[0];
		sel = ref.create_node(sel, {"type":"file"});
		if(sel) {
			ref.edit(sel);
		}
	};
	function demo_rename() {
		var ref = $('#container-for-object-tree').jstree(true),
			sel = ref.get_selected();
		if(!sel.length) { return false; }
		sel = sel[0];
		ref.edit(sel);
	};
	function demo_delete() {
		var ref = $('#container-for-object-tree').jstree(true),
			sel = ref.get_selected();
		if(!sel.length) { return false; }
		ref.delete_node(sel);
	};

	
	
	/*========================================================================*/
	/*========================================================================*/
	/*========================================================================*/

	
	
	window.onload = function() {
		
		/*====  JSTREE    ========================================== */
		
		// search box
		var to = false;
		$('#search-box').keyup(function () {
			if(to) { clearTimeout(to); }
			to = setTimeout(function () {
				var v = $('#search-box').val();
				$('#container-for-object-tree').jstree(true).search(v);
			}, 250);
		});
		
		

		
		// create the tree
		$('#container-for-object-tree').jstree({
		'core' : {
			"animation" : 0,
			"check_callback" : true,
			'force_text' : true,
			"themes" : { "stripes" : false },
			'data' : [
					{ "text" : "Root node", "li_attr": {"description": "this is the object type for speaking cratures in media", "examples":["Donald Duck", "Pluto"], "existing_datapoints":35}, "children" : [
						{ "text" : "Child node 1" , "li_attr": {"description": "this is the object type for ficticious dogs in media", "examples":["Pluto","Bello"], "existing_datapoints":0}},
						{ "text" : "Child node 2" , "li_attr": {"description": "this is the object type for ficticious bears in media", "examples":["gummybears","Winnie the Po"], "existing_datapoints":24}, "children":[
							{"text": "second generation1", "li_attr": {"description": "this is the object type for gummy bears", "examples":["dunno","other"], "existing_datapoints":17}, "children": [
								{"text": "third generation1", "li_attr": {"description": "this is the object type for good gummy bears", "examples":["dunno"], "existing_datapoints":9} },
								{"text": "third generation1", "li_attr": {"description": "this is the object type for bad gummy bears", "examples":["other"], "existing_datapoints":8} }]}, 
							{"text": "second generation2", "additional_info": "anything", "li_attr": {"description": "this is the object type for other bears Poo", "examples":["Winnie the Po"], "existing_datapoints":7} , "children": [
								{"text": "third generation2", "li_attr": {"description": "this is the object type for teletubbies", "examples":["Tinkewincky","Lala","Po"], "existing_datapoints":7} }]}]},
						{ "text" : "Child node 3", "li_attr": {"description": "this is the object type for ficticious ducks in medai", "examples":["Donnald Duck"], "existing_datapoints":11} }]},
				]
			},
			"types" : {
				"#" : { "max_children" : 1, "max_depth" : 4, "valid_children" : ["root"] },
				"root" : { "icon" : "/static/3.3.7/assets/images/tree_icon.png", "valid_children" : ["default"] },
				"default" : { "valid_children" : ["default","file"] },
				"file" : { "icon" : "glyphicon glyphicon-file", "valid_children" : [] }
			},
			"plugins" : [ "contextmenu", "dnd", "search", "state", "types", "wholerow" ]
		});
		/* "state":{"selected":true},*/
		
	
		// if an element of tree is selected, display it's information on the right
		$('#container-for-object-tree')
		  .on('changed.jstree', function (e, data) {
			
			
			$('#jstree-result').html('<h3 id="entity-choice">' + data.instance.get_node(data.selected).text + '</h3> '	+
										'<div class="form-group">'  + 
											'<label class="control-label" for="attribute-description">Description</label>' +
											'<textarea cols="40" rows="3" class="form-control" id="attribute-description">' + data.instance.get_node(data.selected).li_attr["description"] + '</textarea>' +
										'</div>' +
										'<div class="form-group row">  ' +
											'<label for="form-element" class="col-sm-4 col-form-label">Examples</label>' +
											'<div class="col-sm-8">' +
												'<input type="text" readonly class="form-control-plaintext" id="form-element" value="' + data.instance.get_node(data.selected).li_attr["examples"].join(", ") + '">' +
											'</div>' +
										'</div>' + 
										'<div class="form-group row">           ' +
											'<label for="form-element" class="col-sm-4 col-form-label">Existing_datapoints</label>' +
											'<div class="col-sm-8">' +
												'<input type="text" readonly class="form-control-plaintext" id="form-element" value="' + data.instance.get_node(data.selected).li_attr["existing_datapoints"] + '">' +
											'</div>' +
										'</div>');
		  });
		
	
		
		/*====  CREATE-NEW-OBJECT-TYPE MODAL    ========================================== */
		
		//when modal is opened
		$('[data-toggle="modal"]').on('click', function (e) {
		
		});

	};
</script>


	
{% endblock %}
